
<!DOCTYPE html>
<html>
  <head lang="en">
    <meta charset="UTF-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>YODA website</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.8.0/codemirror.min.css">
    <link rel="stylesheet" href="https://unpkg.com/image-compare-viewer/dist/image-compare-viewer.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" type="text/css" href="video_control.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js" type="e157f0faa3d013ba7c0b49ed-text/javascript"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" type="e157f0faa3d013ba7c0b49ed-text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.8.0/codemirror.min.js" type="e157f0faa3d013ba7c0b49ed-text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.3/clipboard.min.js" type="e157f0faa3d013ba7c0b49ed-text/javascript"></script>
    <script src="https://unpkg.com/image-compare-viewer/dist/image-compare-viewer.min.js" type="e157f0faa3d013ba7c0b49ed-text/javascript"></script>
  </head>
  <body>
    <div class="container" id="main">
      <div class="row">
        <h1 class="col-md-12 text-center">
          AI-Empowered Anticipation of <i>Surgical Triplets</i> 
        </br>in Laparoscopic Videos for Enhanced Decision Support</br>
          <small>
            <a href="https://bot-white-g1ve.github.io/">Axel Hu</a>, <a href="">Daochang Liu</a>, 
            <a href="">Tony Pang</a>, <a href="">David Tovmassian</a>, <a href="">Chang Xu</a>
          </small>
          <br>
          <small>
            The University of Sydney, Westmead Hospital
          </small>
	        <br>
          <small>
            E-mail: xintao.hu@sydney.edu.au; daochang.liu@sydney.edu.au; tony.pang@sydney.edu.au; david.tovmassian@health.nsw.gov.au; chang.xu@sydney.edu.au
          </small>
        </h1>
      </div>
    </div>  

    <div class="col-md-6 col-md-offset-3" style="padding-top: 2rem;">
      <div>
        <div class="col-md-6 text-center">
          <h2>
            <a href="">[GitHub(Unpublished Yet)]</a>
          </h2>
        </div>
        <div class="col-md-6 text-center">
          <h2>
            <a href="">[Arxiv(Unpublished Yet)]</a>
          </h2>
        </div>
      </div>
    </div>

    <div class="col-md-6 col-md-offset-3" style="padding-top: 2rem;">
      <div>
        <div class="col-md-12 text-center">
          <img src="media/front2.png" width="100%" alt="" float="left">
        </div>
      </div>
    </div>

    <div class="col-md-8 col-md-offset-2" style="padding-top: 2rem;">
      <div>
        <h2>Abstract<br>
          <small>
            The development of intra-operative context-aware decision support systems is crucial for enhancing decision-making and analysing surgical workflow. We introduce <i>SurgAnt</i>, a diffusion-based model designed to aid decision-making during surgery by predicting action triplets several frames ahead based on laparoscopic video footage, where each action triplet is composed by: &lt;Instrument, Verb, Target&gt;. 
            <br>We evaluated our model on laparoscopic videos performed by professional surgeons. The results demonstrated that our model can accurately predict the next triplets in most cases, highlighting its potential to assist operating surgeons during surgery. Our model can also serve as the training tool for medical interns and can be integrated into other computer-assisted intervention (CAI) systems.
          </small>
        </h2>
      </div>
    </div>

    <div class="col-md-8 col-md-offset-2" style="padding-top: 2rem;">
      <div>
        <h2>Technical Overview</h2>
        <h3>Surgical Triplets</h3>
        <table border="1"> <!-- 设置边框为1 -->
          <tr>
            <th></th>
            <th>Triplet</th>
            <th>Instument</th>
            <th>Action</th>
            <th>Target</th>
          </tr>
          <tr>
            <td>Number of Categories</td>
            <td>100</td>
            <td>6</td>
            <td>10</td>
            <td>15</td>
          </tr>
          <tr>
            <td rowspan="15">Components</td>
            <td rowspan="15"></td>
            <td>grasper</td>
            <td>grasp</td>
            <td>gallbladder</td>
          </tr>
          <tr>
            <td>bipolar</td>
            <td>retract</td>
            <td>cystic-plate</td>
          </tr>
          <tr>
            <td>hook</td>
            <td>dissect</td>
            <td>cystic-duct</td>
          </tr>
          <tr>
            <td>scissors</td>
            <td>coagulate</td>
            <td>cystic-artery</td>
          </tr>
          <tr>
            <td>clipper</td>
            <td>clip</td>
            <td>cystic-pedicle</td>
          </tr>
          <tr>
            <td>irrigator</td>
            <td>cut</td>
            <td>blood-vessel</td>
          </tr>
          <tr>
            <td rowspan="10"></td>
            <td>aspirate</td>
            <td>fluid</td>
          </tr>
          <tr>
            <td>irrigate</td>
            <td>abdominal-wall/cavity</td>
          </tr>
          <tr>
            <td>pack</td>
            <td>liver</td>
          </tr>
          <tr>
            <td>null-verb</td>
            <td>adhesion</td>
          </tr>
          <tr>
            <td rowspan="5"></td>
            <td>omentum</td>
          </tr>
          <tr>
            <td>peritoneum</td>
          </tr>
          <tr>
            <td>gut</td>
          </tr>
          <tr>
            <td>specimen-bag</td>
          </tr>
          <tr>
            <td>null-target</td>
          </tr>
        </table>
        <h3>Module Structure</h3>
        <img src="media/structure.png" width="100%">
      </div>
    </div>

    <div class="col-md-8 col-md-offset-2" style="padding-top: 2rem;">
      <div>
          <h2>DEMO</h2>
          <div class="video-selector">
              <label for="videoSelect">Select a video: </label>
              <select id="videoSelect">
                  <option value="VID01">VID01</option>
                  <option value="VID05">VID05</option>
                  <option value="VID20">VID20</option>
                  <!-- Add more videos as needed -->
              </select>
          </div>
          <div class="image-container">
              <div class="image-item">
                  <img id="image1" alt="Frame 1">
                  <p id="description1" class="description">Description for Frame 1</p>
              </div>
              <div class="image-item">
                  <img id="image2" alt="Frame 2">
                  <p id="description2" class="description">Description for Frame 2</p>
              </div>
          </div>
          <div class="slider-container">
              <input type="range" id="slider" min="0" max="100" value="0">
          </div>
      </div>
  </div>
  
  <div class="row">
      <div class="col-md-8 col-md-offset-2">
          <h3>Acknowledgements</h3>
          <p class="text-justify">
              The website template was borrowed from <a href="https://kfmei.page/vidm/">VIDM</a>.
          </p>
      </div>
  </div>
  
  <script>
      // 动态生成图片路径
      function generateImagePaths(vid, start, end, step) {
          const images = [];
          for (let i = start; i <= end; i += step) {
              const paddedNumber = i.toString().padStart(6, '0');
              images.push(`media/${vid}/${paddedNumber}.png`);
          }
          return images;
      }

      async function fetchTextFile(filePath, startLine = 0) {
          try {
              const response = await fetch(filePath);
              if (!response.ok) {
                  throw new Error(`Failed to load file: ${filePath}`);
              }
              const text = await response.text();
              const lines = text.split('\n');
              return lines.slice(startLine);  // 从指定行开始读取
          } catch (error) {
              console.error(error);
              return [];  // 如果读取失败，返回一个空数组
          }
      }

      async function generateDescriptions(vid) {
          const triplets = await fetchTextFile(`media/${vid}/triplet.txt`);
          const predictions = await fetchTextFile(`media/${vid}/triplet.txt`, 4);  // 从第五行开始读取（索引从0开始，因此是4）
          return { triplets, predictions };
      }


      async function updateContent(video) {
        console.log(`Loading content for video: ${video}`);
        const data = videoData[video];
        
        // 动态获取描述内容
        const { triplets, predictions } = await generateDescriptions(video);
        console.log(`Triplets:`, triplets);
        console.log(`Predictions:`, predictions);

        slider.max = data.images1.length - 1;

        slider.addEventListener("input", function() {
            const index = Math.floor(slider.value); 
            image1.src = data.images1[index];
            image2.src = data.images2[index];
            description1.textContent = `current triplet: ${triplets[index]}` || "No description available";
            description2.textContent = `predicted triplet: ${predictions[index]}` || "No prediction available";
        });

        // Reset the slider and initial images/descriptions
        slider.value = 0;
        image1.src = data.images1[0];
        image2.src = data.images2[0];
        description1.textContent = `current triplet: ${triplets[0]}` || "No description available";
        description2.textContent = `predicted triplet: ${predictions[0]}` || "No prediction available";
      }


      const videoData = {
          VID01: {
              images1: generateImagePaths('VID01', 0, 100, 1),
              images2: generateImagePaths('VID01', 5, 105, 1)
          },
          VID05: {
              images1: generateImagePaths('VID05', 0, 100, 1),
              images2: generateImagePaths('VID05', 5, 105, 1)
          },
          VID10: {
              images1: generateImagePaths('VID10', 0, 100, 1),
              images2: generateImagePaths('VID10', 5, 105, 1)
          },
      };

      const videoSelect = document.getElementById("videoSelect");
      const image1 = document.getElementById("image1");
      const image2 = document.getElementById("image2");
      const description1 = document.getElementById("description1");
      const description2 = document.getElementById("description2");
      const slider = document.getElementById("slider");

      // Initialize with the first video
      updateContent("VID01");

      // Update content when a new video is selected
      videoSelect.addEventListener("change", function() {
          updateContent(this.value);
      });
  </script>
  
  </body>
</html>
